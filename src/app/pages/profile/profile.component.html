<div class="main">
  <div class="container-info">
    <div class="card">
      <div class="cardH1">
        <h2>Hello {{ user?.name }}</h2>
        <button
          (click)="scrollToContainer()"
          class="btn"
          color="primary"
          mat-stroked-button
        >
          See your posts
        </button>
      </div>
      <div class="userPanel">
        <div class="card-user-header">
          <p-toast></p-toast>
          <p-confirmPopup></p-confirmPopup>
          <form class="form" enctype="multipart/form-data">
            <div class="card-img">
              @if(user.profile_pic){
              <img
                class="userPerfilImg"
                src="{{ user.profile_pic }}"
                alt=""
              />            
              }@else{
                <p-skeleton height="100%" class="img-icon" shape="circle"></p-skeleton>
              } 
              @if (!this.selectedFile) {
                <form class="icon" enctype="multipart/form-data">
                  <label class="file-label">
                    <mat-icon #fileIcon>add_a_photo</mat-icon>
                    <input
                      #fileInput
                      type="file"
                      class="form-control"
                      (change)="handleFileInput($event)"
                    />
                  </label>
                </form>
              } @else {

                <div class="icon">
                  <button (click)="confirm1($event)" class="upload" color="primary" mat-icon-button>
                    <mat-icon>cloud_upload</mat-icon>
                  </button>
                </div>
              }

            </div>

          </form>
        </div>

        <form class="form2" [formGroup]="userForm">
          <div class="parent">
            <mat-form-field appearance="outline">
              <mat-label>First Name</mat-label>
              <input
                formControlName="firstName"
                type="text"
                matInput
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Last Name</mat-label>
              <input
                formControlName="lastName"
                type="text"
                matInput
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Telephone</mat-label>
              <input
                formControlName="telephone"
                type="tel"
                mask="(00) 0 0000 0000"
                prefix="+55 "
                matInput
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Address</mat-label>
              <input
                formControlName="address"
                type="text"
                matInput
              />
              <button (click)="autocomplete(this.userForm.value.address)" color="primary" mat-icon-button matSuffix style="cursor: pointer;">
                <mat-icon color="primary">search</mat-icon>
              </button>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>CEP</mat-label>
              <input
                formControlName="cep"
                type="text"
                mask="00000-000"
                matInput
              />
            </mat-form-field>
          </div>
          <button
            class="btn"
            type="submit"
            color="primary"
            mat-stroked-button
            [disabled]="disableButton"
            (click)="confirm2($event)"
          >
            Update Profile
          </button>
        </form>
      </div>
    </div>
  </div>

  @if (this.petList.length > 0) {
    <div class="container-posts" id="container-posts">
      <div class="petList">
        <h3>Your posts</h3>
        <div class="cards-container">
          @for (pet of petList; track pet.id) {
          <mat-list class="cards">
            <div class="header-card">
              <img class="img-icon" src="{{ user.profile_pic }}"/>
              <p class="userName">{{ user.name }}</p>
              @if (pet.status == 'Rescued') {
                <button color="accent" class="btn-header" mat-stroked-button>
                  {{ pet.status }}
                </button>
              }@else {
                <button color="warn" class="btn-header" mat-stroked-button>
                  {{ pet.status }}
                </button>
              }
            </div>
            <div class="pet_image">
              @if(pet.filename){
                @defer (on viewport){
                  <img class="img-pet" src="{{ pet.filename }}"/>
                } @placeholder (minimum 300ms) {
                  <p-skeleton width="400px" height="300px"></p-skeleton>
                }
              } @else {
                <p-skeleton width="400px" height="300px"></p-skeleton>
              }
            </div>
    
            <mat-list-item></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Id: <span>{{ pet.id }}</span></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Pet Name: <span>{{ pet.name }}</span></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Breed: <span>{{ pet.breed }}</span></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Specie: <span>{{ pet.species }}</span></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Sex: <span>{{ pet.sex }}</span></mat-list-item>
            <mat-divider></mat-divider>
            <mat-list-item>Last Location: <span>{{ pet.last_location }}</span></mat-list-item>
            <mat-divider></mat-divider>
    
            <div class="btn-div">
              @if (pet.status == 'Rescued') {
                <button
                type="text"
                class="btn"
                color="accent"
                mat-stroked-button
              >
                See happy storie
              </button>
              } @else {
                <button
                (click)="confirm3($event, pet.id)"
                type="text"
                class="btn"
                color="warn"
                mat-stroked-button
              >
                Delete post
              </button>
              }
            </div>
          </mat-list>
          }
        </div>
        </div>
      </div>

  }
  </div>
